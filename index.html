<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>League XD</title>
    <link rel="stylesheet" href="css/style.css"/>

</head>
<body>
    <div id="container">

    </div>
    <script>
        const apiUrl = 'https://laptop.local';
        fetchAndDisplayData();

        function fetchAndDisplayData() {
            const container = document.createElement('div');

            fetch(`${apiUrl}/game/last`)
                .then(response => response.json())
                .then(data => {
                    const participants = data.game.info.participants;

                    console.log(participants);
                    container.classList.add('cards-container')

                    participants.forEach(participant => {
                        const card = document.createElement('div');
                        card.classList.add('card');
                        card.classList.add(`team-${participant.team_id}`);
                        card.style.border = '1px solid black';
                        card.style.padding = '10px';
                        card.style.margin = '10px';

                        const label1 = document.createElement('label');
                        label1.textContent = `${participant.champion_name}`;
                        card.appendChild(label1);

                        const label2 = document.createElement('label');
                        label2.textContent = `${participant.summoner_name}`;
                        card.appendChild(label2);

                        const label3 = document.createElement('label');
                        label3.textContent = `Comment:`;
                        card.appendChild(label3);

                        const input = document.createElement('input');
                        input.type = 'text';
                        input.name = 'comment';
                        input.value = `${participant.comment}`;
                        input.setAttribute('data-id', participant.id);
                        card.appendChild(input);

                        container.appendChild(card);
                    });

                    const submitButton = document.createElement('button');

                    submitButton.textContent = 'Submit';
                    submitButton.addEventListener('click', async () => {
                        const inputs = document.querySelectorAll('input[type="text"]');

                        const data = [];
                        for (const input of inputs) {
                            data.push({
                                id: input.getAttribute('data-id'),
                                comment: input.value,
                            })
                        }

                        const response = await fetch(`${apiUrl}/game/save-result`, {
                            method: 'POST',
                            mode: 'no-cors', // no-cors, *cors, same-origin
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(data)
                        });

                        window.location.href='room.html';
                    });

                    document.getElementById('container').appendChild(submitButton);

                    document.getElementById('container').appendChild(container);
                });


        }





    </script>
</body>
</html>